<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://sequenceiq.com/cloudbreak-deployer/periscope/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Auto-Scaling - Cloudbreak</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation" background="red">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <img class="navbar-logo" src="http://docs.hortonworks.com/HDPDocuments/Ambari-2.1.0.0/bk_Installing_HDP_AMB/common/images/hortonworks-logo.png" alt="Hortonworks Documentation" width="132" height="52">
            <a class="navbar-brand" href="..">Cloudbreak</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/">Architecture</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Installation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../onprem/">Cloudbreak Deployer</a>
</li>

        
            
<li >
    <a href="../aws-image/">AWS Cloud Images</a>
</li>

        
            
<li >
    <a href="../gcp-image/">GCP Cloud Images</a>
</li>

        
            
<li >
    <a href="../openstack-image/">OpenStack Cloud Images</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../releasenotes/">Release Notes</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cloud Providers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">AWS</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../aws/">Setup</a>
</li>

        
            
<li >
    <a href="../aws_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../aws_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../aws_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Azure</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../azure/">Setup</a>
</li>

        
            
<li >
    <a href="../azure_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../azure_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../azure_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">GCP</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../gcp/">Setup</a>
</li>

        
            
<li >
    <a href="../gcp_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../gcp_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../gcp_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">OpenStack</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../openstack/">Setup</a>
</li>

        
            
<li >
    <a href="../openstack_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../openstack_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../openstack_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">API</a>
</li>

                        
                            
<li >
    <a href="../shell/">CLI/Shell</a>
</li>

                        
                            
<li class="active">
    <a href="./">Auto-Scaling</a>
</li>

                        
                            
<li >
    <a href="../recipes/">Recipes</a>
</li>

                        
                            
<li >
    <a href="../blueprints/">Blueprints</a>
</li>

                        
                            
<li >
    <a href="../kerberos/">Kerberos</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../operations/">Operations</a>
</li>

                        
                            
<li >
    <a href="../database/">Migration</a>
</li>

                        
                            
<li >
    <a href="../configuration/">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../development/">Development</a>
</li>

                        
                            
<li >
    <a href="../changelog/">Changelog</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                    <ul class="dropdown-menu" id="versions-dropdown">
                    </ul>
                </li>
                
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../shell/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../recipes/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#auto-scaling">Auto-Scaling</a></li>
        
            <li><a href="#how-it-works">How It Works</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="auto-scaling">Auto-Scaling</h1>
<p>The purpose of <code>auto-scaling</code> is to apply SLA scaling policies to a Cloudbreak-managed Hadoop cluster.</p>
<blockquote>
<p>This feature is currently <code>TECHNICAL PREVIEW</code>.</p>
</blockquote>
<h2 id="how-it-works">How It Works</h2>
<p>The auto-scaling capabilities is based on <a href="https://cwiki.apache.org/confluence/display/AMBARI/Metrics">Ambari Metrics</a> - and <a href="https://cwiki.apache.org/confluence/display/AMBARI/Alerts">Ambari Alerts</a>. Based on the Blueprint
used and the running services, Cloudbreak can access all the available metrics from the subsystem and define <code>alerts</code> based on this information.</p>
<p>Beside the default Ambari Metrics, Cloudbreak includes two custom metrics: <code>Pending YARN containers</code> and <code>Pending applications</code>. These two custom metrics works with the YARN subsystem in order to bring <code>application</code> level QoS to the cluster.</p>
<blockquote>
<p>In order to use the <code>autoscaling</code> feature with Cloudbreak you will have to enable from the UI or shell.</p>
</blockquote>
<p><img alt="" src="../images/enable_periscope.png" /></p>
<h4 id="alerts">Alerts</h4>
<p>Auto-scaling supports two <strong>Alert</strong> types: <code>metric</code> and <code>time</code> based.</p>
<p><strong>Metric-based Alerts</strong></p>
<p>Metric based alerts are using the default (or custom) Ambari metrics. These metrics have a default <code>Threshold</code> value configured in Ambari - nevertheless these thresholds can be configured, changed or altered in Ambari. In order to change the default threshold for a metric please go to Ambari UI and select the <code>Alerts</code> tab and the metric. The values can be changed in the <code>Threshold</code> section.</p>
<p><img alt="" src="../images/ambari_threshold.png" /></p>
<p>Metric alerts have a few configurable fields.</p>
<ul>
<li><code>alert name</code> - name of the alert</li>
<li><code>description</code> - description of the alert</li>
<li><code>metric - desired state</code> - the Ambari metrics based on the installed services and their <em>state</em> (OK, WARN, CRITICAL), based on the <em>threshold</em> value</li>
<li><code>period</code> - for how many <em>minutes</em> the metric state has to be sustained in order for an alert to be triggered</li>
</ul>
<p><img alt="" src="../images/metric_alert.png" /></p>
<p><strong>Time-based Alerts</strong></p>
<p>Time based alerts are based on <code>cron</code> expressions and allow alerts to be triggered based on time.</p>
<p>Time alerts have a few configurable fields.</p>
<ul>
<li><code>alert name</code> - name of the alert</li>
<li><code>description</code> - description of the alert</li>
<li><code>time zone</code> - the time zone</li>
<li><code>crom expression</code> - the <em>cron</em> expression to be used for the alert</li>
</ul>
<p><img alt="" src="../images/time_alert.png" /></p>
<h4 id="scaling-policies">Scaling Policies</h4>
<p>Scaling is the ability to increase or decrease the capacity of the Hadoop cluster or application based on an alert.
When scaling policies are used, the capacity is automatically increased or decreased according to the conditions defined.
Cloudbreak will do the heavy lifting and based on the alerts and the scaling policy linked to them it executes the associated policy. We scaling granularity is at the <code>hostgroup</code> level - thus you have the option to scale services or components only, not the whole cluster.</p>
<p>Scaling policies have a few configurable fields.</p>
<ul>
<li><code>policy name</code> - name of the scaling policy</li>
<li><code>scaling adjustment</code> - the number of added or removed noded based on <code>node count</code> (the number of nodes), <code>percentage</code> (computed percentage adjustment based on the cluster size) and <code>exact</code> (a given exact size of the cluster)</li>
<li><code>host group</code> - the Ambari hostgroup to be scaled</li>
<li><code>alert</code> - the triggered alert based on that the scaling policy applies</li>
</ul>
<p><img alt="" src="../images/policy.png" /></p>
<h4 id="cluster-scaling-configuration">Cluster Scaling Configuration</h4>
<p>An SLA scaling policy can contain multiple alerts. When an alert is triggered a <code>scaling adjustment</code> is applied, however to keep the cluster size within boundaries a <code>cluster size min.</code> and <code>cluster size max.</code> is attached to the cluster - thus a scaling policy can never over or undersize a cluster. Also in order to avoid stressing the cluster we have introduced a <code>cooldown time</code> period (minutes) - though an alert is raised and there is an associated scaling policy, the system will not apply the policy within the configured timeframe. In an SLA scaling policy the triggered rules are applied in order.</p>
<ul>
<li><code>cooldown time</code> - period (minutes) between two scaling events while the cluster is locked from adjustments</li>
<li><code>cluster size min.</code> - size will never go under the minimum value, despite scaling adjustments</li>
<li><code>cluster size max.</code> - size will never go above the maximum value, despite scaling adjustments</li>
</ul>
<p><img alt="" src="../images/scaling_config.png" /></p>
<p><strong>Downscale Scaling Considerations</strong></p>
<p>Cloudbreak auto-scaling will try to keep a healthy cluster, thus does several background checks during <code>downscale</code>.</p>
<ul>
<li>We never remove <code>Application master nodes</code> from a cluster. In order to make sure that a node running AM is not removed, Cloudbreak has to be able to access the YARN Resource Manager - when creating a cluster using the <code>default</code> secure network template please make sure that the RM's port is open on the node</li>
<li>In order to keep a healthy HDFS during downscale we always keep the configured <code>replication</code> factor and make sure there is enough <code>space</code> on HDFS to rebalance data. Also during downscale in order to minimize the rebalancing, replication and HDFS storms we check block locations and compute the least costly operations.</li>
</ul></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="https://gliderlabs.com/pagebuilder">Pagebuilder</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

         <script>
           $( document ).ready(function() {
               $.getJSON("http://sequenceiq.com/cloudbreak-deployer/versions.json", function(data) {
               $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-deployer/latest">latest ('+data.latest+')</a></li>');
                $.each(data.versions, function( index, value ) {
                  $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-deployer/'+value+'">'+value+'</a></li>');
                });
               });

               <!--AWS Table-->
               $.getJSON("../providers/aws.json", function(data) {
               $("#aws-image-details").append('<br>');
               $("#aws-image-details").append('<br>');
               $("#aws-image-details").append('<table>');
                 $("#aws-image-details").append('<col width="290">');
                 $("#aws-image-details").append('<col width="290">');
                 $("#aws-image-details").append('<thead>');
                  $("#aws-image-details").append('<tr>');
                   $("#aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Region" + '</th>');
                   $("#aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Image Name" + '</th>');
                  $("#aws-image-details").append('</tr>');
                 $("#aws-image-details").append('</thead>');
                $("#aws-image-details").append('<tbody>');
                 $.each(data.metadata, function( index, value ) {
                 if (index.indexOf("region.") === 0) {
                   shortIndex = index.substring(7)
                  $("#aws-image-details").append('<tr>');
                   $("#aws-image-details").append('<td halign="center" valign="center" text-align="left" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + shortIndex + '</td>');
                   $("#aws-image-details").append('<td halign="center" valign="center" text-align="right" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + value + '</td>');
                  $("#aws-image-details").append('</tr>');
                  }
                 });
                $("#aws-image-details").append('</tbody>');
               $("#aws-image-details").append('</table>');
               });

               <!--OpenStack-->
               $.getJSON("../providers/openstack.json", function(data) {
               $("#openstack-image-details").append('<br>');
               $("#openstack-image-details").append('<br>');
               $("#openstack-image-details").append('<p style="font-size: 12pt"><code>LATEST_IMAGE:</code>' + data.id + '</p>');
               $("#openstack-image-details").append('<pre><code style="font-size: 12pt;color:#333333">curl -L  https://atlas.hashicorp.com/api/v1/artifacts/sequenceiq/cbd/openstack.image/' + data.version + '/file | tar -xz</code></pre>');
               });

               <!--GCP-->
               $.getJSON("../providers/gcp.json", function(data) {
               $("#gcp-image-details").append('<br>');
               $("#gcp-image-details").append('<br>');
               $("#gcp-image-details").append('<pre><code style="font-size: 12pt;color:#333333">gcloud compute images create ' + data.gcp.id + ' --source-uri gs://' + data.gcp.source_image + '</code></pre>');
               });
           });
         </script>
    </body>
</html>
