<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://sequenceiq.com/cloudbreak-deployer/aws_pre_prov/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Provisioning Prerequisites - Cloudbreak</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation" background="red">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <img class="navbar-logo" src="http://docs.hortonworks.com/HDPDocuments/Ambari-2.1.0.0/bk_Installing_HDP_AMB/common/images/hortonworks-logo.png" alt="Hortonworks Documentation" width="132" height="52">
            <a class="navbar-brand" href="..">Cloudbreak</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">Introduction</a>
</li>

                        
                            
<li >
    <a href="../architecture/">Architecture</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Installation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../onprem/">Cloudbreak Deployer</a>
</li>

        
            
<li >
    <a href="../aws-image/">AWS Cloud Images</a>
</li>

        
            
<li >
    <a href="../gcp-image/">GCP Cloud Images</a>
</li>

        
            
<li >
    <a href="../openstack-image/">OpenStack Cloud Images</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../releasenotes/">Release Notes</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cloud Providers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">AWS</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../aws/">Setup</a>
</li>

        
            
<li class="active">
    <a href="./">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../aws_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../aws_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Azure</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../azure/">Setup</a>
</li>

        
            
<li >
    <a href="../azure_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../azure_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../azure_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">GCP</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../gcp/">Setup</a>
</li>

        
            
<li >
    <a href="../gcp_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../gcp_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../gcp_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">OpenStack</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../openstack/">Setup</a>
</li>

        
            
<li >
    <a href="../openstack_pre_prov/">Provisioning Prerequisites</a>
</li>

        
            
<li >
    <a href="../openstack_cb_ui/">Provisioning - UI</a>
</li>

        
            
<li >
    <a href="../openstack_cb_shell/">Provisioning - CLI</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">API</a>
</li>

                        
                            
<li >
    <a href="../shell/">CLI/Shell</a>
</li>

                        
                            
<li >
    <a href="../periscope/">Auto-Scaling</a>
</li>

                        
                            
<li >
    <a href="../recipes/">Recipes</a>
</li>

                        
                            
<li >
    <a href="../blueprints/">Blueprints</a>
</li>

                        
                            
<li >
    <a href="../kerberos/">Kerberos</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../operations/">Operations</a>
</li>

                        
                            
<li >
    <a href="../database/">Migration</a>
</li>

                        
                            
<li >
    <a href="../configuration/">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../development/">Development</a>
</li>

                        
                            
<li >
    <a href="../changelog/">Changelog</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
                    <ul class="dropdown-menu" id="versions-dropdown">
                    </ul>
                </li>
                
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../aws/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../aws_cb_ui/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#provisioning-prerequisites">Provisioning Prerequisites</a></li>
        
            <li><a href="#iam-role-setup">IAM role setup</a></li>
        
            <li><a href="#generate-a-new-ssh-key">Generate a new SSH key</a></li>
        
            <li><a href="#next-steps">Next steps</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="provisioning-prerequisites">Provisioning Prerequisites</h1>
<h2 id="iam-role-setup">IAM role setup</h2>
<p>Cloudbreak works by connecting your AWS account through so called <em>Credentials</em>, and then uses these credentials to create resources on your behalf.</p>
<blockquote>
<p><strong>Important</strong> Cloudbreak deployment uses two different AWS accounts for two different purposes:</p>
</blockquote>
<ul>
<li>The account belonging to the <em>Cloudbreak webapp</em> itself that acts as a <em>third party</em> that creates resources on the account of the <em>end-user</em>. This account is configured at server-deployment time.</li>
<li>The account belonging to the <em>end user</em> who uses the UI or the Shell to create clusters. This account is configured when setting up credentials.</li>
</ul>
<p>These two accounts are usually <em>the same</em> when the end user is the same who deployed the Cloudbreak server, but it allows Cloudbreak to act as a SaaS project as well if needed.</p>
<p>Credentials use <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">IAM Roles</a> to give access to the third party to act on behalf of the end user without giving full access to your resources.
This IAM Role will be <em>assumed</em> later by the deployment account.
This section is about how to setup the IAM role, to see how to setup the <em>deployment</em> account check out <a href="../aws/">this description</a>.</p>
<p>To connect your (<em>end user</em>) AWS account with a credential in Cloudbreak you'll have to create an IAM role on your AWS account that is configured to allow the third-party account to access and create resources on your behalf.
The easiest way to do this is with cbd commands (but it can also be done manually from the <a href="https://console.aws.amazon.com">AWS Console</a>):</p>
<pre><code>cbd aws generate-role  - Generates an AWS IAM role for Cloudbreak provisioning on AWS
cbd aws show-role      - Show assumers and policies for an AWS role
cbd aws delete-role    - Deletes an AWS IAM role, removes all inline policies
</code></pre>

<p>The <code>generate-role</code> command creates a role that is assumable by the Cloudbreak Deployer AWS account and has a broad policy setup.
By default the <code>generate-role</code> command creates a role with the name <code>cbreak-deployer</code>.
If you'd like to create the role with a different name or if you'd like to create multiple roles then the role's name can be changed by adding this line to your <code>Profile</code>:</p>
<pre><code>export AWS_ROLE_NAME=my-cloudbreak-role
</code></pre>

<p>You can check the generated role on your AWS console, under IAM roles:</p>
<p><img alt="" src="../images/aws-iam-role.png" /></p>
<h2 id="generate-a-new-ssh-key">Generate a new SSH key</h2>
<p>All the instances created by Cloudbreak are configured to allow key-based SSH,
so you'll need to provide an SSH public key that can be used later to SSH onto the instances in the clusters you'll create with Cloudbreak.
You can use one of your existing keys or you can generate a new one.</p>
<p>To generate a new SSH keypair:</p>
<pre><code>ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;
# Creates a new ssh key, using the provided email as a label
# Generating public/private rsa key pair.
</code></pre>

<pre><code># Enter file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter]
You'll be asked to enter a passphrase, but you can leave it empty.

# Enter passphrase (empty for no passphrase): [Type a passphrase]
# Enter same passphrase again: [Type passphrase again]
</code></pre>

<p>After you enter a passphrase the keypair is generated. The output should look something like below.</p>
<pre><code># Your identification has been saved in /Users/you/.ssh/id_rsa.
# Your public key has been saved in /Users/you/.ssh/id_rsa.pub.
# The key fingerprint is:
# 01:0f:f4:3b:ca:85:sd:17:sd:7d:sd:68:9d:sd:a2:sd your_email@example.com
</code></pre>

<p>Later you'll need to pass the <code>.pub</code> file's contents to Cloudbreak and use the private part to SSH to the instances.</p>
<h2 id="next-steps">Next steps</h2>
<p>After your IAM role is configured and you have an SSH key you can move on to create clusters on the <a href="../aws_cb_ui/">UI</a> or with the <a href="../aws_cb_shell/">Shell</a>.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="https://gliderlabs.com/pagebuilder">Pagebuilder</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

         <script>
           $( document ).ready(function() {
               $.getJSON("http://sequenceiq.com/cloudbreak-deployer/versions.json", function(data) {
               $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-deployer/latest">latest ('+data.latest+')</a></li>');
                $.each(data.versions, function( index, value ) {
                  $("#versions-dropdown").append('<li><a href="http://sequenceiq.com/cloudbreak-deployer/'+value+'">'+value+'</a></li>');
                });
               });

               <!--AWS Table-->
               $.getJSON("../providers/aws.json", function(data) {
               $("#aws-image-details").append('<br>');
               $("#aws-image-details").append('<br>');
               $("#aws-image-details").append('<table>');
                 $("#aws-image-details").append('<col width="290">');
                 $("#aws-image-details").append('<col width="290">');
                 $("#aws-image-details").append('<thead>');
                  $("#aws-image-details").append('<tr>');
                   $("#aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Region" + '</th>');
                   $("#aws-image-details").append('<th halign="center" style="font-size: 14pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + "Image Name" + '</th>');
                  $("#aws-image-details").append('</tr>');
                 $("#aws-image-details").append('</thead>');
                $("#aws-image-details").append('<tbody>');
                 $.each(data.metadata, function( index, value ) {
                 if (index.indexOf("region.") === 0) {
                   shortIndex = index.substring(7)
                  $("#aws-image-details").append('<tr>');
                   $("#aws-image-details").append('<td halign="center" valign="center" text-align="left" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + shortIndex + '</td>');
                   $("#aws-image-details").append('<td halign="center" valign="center" text-align="right" style="font-size: 12pt;border:none;border-bottom:solid #DDDDDD 1.5pt;padding:6.0pt 6.0pt 6.0pt 6.0pt">' + value + '</td>');
                  $("#aws-image-details").append('</tr>');
                  }
                 });
                $("#aws-image-details").append('</tbody>');
               $("#aws-image-details").append('</table>');
               });

               <!--OpenStack-->
               $.getJSON("../providers/openstack.json", function(data) {
               $("#openstack-image-details").append('<br>');
               $("#openstack-image-details").append('<br>');
               $("#openstack-image-details").append('<p style="font-size: 12pt"><code>LATEST_IMAGE:</code>' + data.id + '</p>');
               $("#openstack-image-details").append('<pre><code style="font-size: 12pt;color:#333333">curl -L  https://atlas.hashicorp.com/api/v1/artifacts/sequenceiq/cbd/openstack.image/' + data.version + '/file | tar -xz</code></pre>');
               });

               <!--GCP-->
               $.getJSON("../providers/gcp.json", function(data) {
               $("#gcp-image-details").append('<br>');
               $("#gcp-image-details").append('<br>');
               $("#gcp-image-details").append('<pre><code style="font-size: 12pt;color:#333333">gcloud compute images create ' + data.gcp.id + ' --source-uri gs://' + data.gcp.source_image + '</code></pre>');
               });
           });
         </script>
    </body>
</html>
